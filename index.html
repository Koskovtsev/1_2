<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <script>
        "use strict"
        const csvText =
            `48.30,32.16,Кропивницький,200000,
            44.38, 34.33, Алушта, 31440,
            49.46, 30.17, Біла Церква, 200131,
            49.54, 28.49, Бердичів, 87575, #некоммент

            #
            46.49, 36.58, #Бердянськ, 121692,
            49.15, 28.41, Вінниця, 356665,
            #45.40, 34.29, Джанкой, 43343,

            # в цьому файлі три рядки - коментаря :) `;
        const textToChange = "Я перший раз у місті Кропивницький і другий раз у місті Алушта";
        const oneMoreText = "Вінниця - найкраще місто!";
        function csvHandler() {
            let filteredLine = csvText
                .trim()
                .split(`\n`)
                .filter((line) => !(line.trim().startsWith('#') || line.trim() === ""));
            let top10Cities = filteredLine.map((line) => {
                let elem = line.trim().split(',');
                return {
                    x: +elem[0],
                    y: +elem[1],
                    cityName: elem[2].replace(/[^а-яіїєґ\-\'\’\ ]/gi, ""),
                    cityPopulation: +elem[3]
                }
            }).sort((a, b) => b.cityPopulation - a.cityPopulation)
                .slice(0, 10)
                .reduce((acc, city, index) => {
                    name = city.cityName.toLowerCase().trim();
                    acc[name] = {
                        population: city.cityPopulation,
                        rate: index + 1
                    }
                    return acc;
                }, {});
            let cityList = Object.keys(top10Cities).join('|');
            const pattern = new RegExp(cityList, "gi");
            function modifyCity(matchedCityName) {
                let cityNameThatWeHaveFound = matchedCityName.charAt(0).toUpperCase() + matchedCityName.slice(1);
                return `${cityNameThatWeHaveFound} (${top10Cities[matchedCityName].rate} місце в ТОП-10 найбільших міст України, населення ${top10Cities[matchedCityName].population} людина/людини/людей)`;
            }
            return function (textThatMustBeChanged) {
                let result = textThatMustBeChanged.toLowerCase().replace(pattern, modifyCity);
                return result;
            }
        }
        const transformer = csvHandler();
        console.log(transformer(textToChange));
        console.log(transformer(oneMoreText));
    </script>
</body>

</html>